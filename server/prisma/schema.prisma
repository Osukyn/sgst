// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      =  "postgresql://sgst_user:sgst_password@localhost:5432/sgst_db"

}

model Personne {
  id            Int           @id @default(autoincrement())
  email         String        @unique
  prenom        String
  nom           String
  adresse       String
  ville         String
  cp            String        @db.VarChar(5)
  telephone     String        @db.VarChar(10)
  dateNaissance DateTime      @db.Date
  licencie      Licencie?
  moniteur      Moniteur?
  reservations  Reservation[]
}

model Moniteur {
  numAgrement  Int           @id @default(autoincrement())
  personne     Personne      @relation(fields: [personneId], references: [id])
  personneId   Int           @unique
  reservations Reservation[]
}

model Licencie {
  numLicencie         Int                   @id @default(autoincrement())
  annee               Int
  personneId          Int                   @unique
  personne            Personne              @relation(fields: [personneId], references: [id])
  possedeHabilitation PossedeHabilitation[]
  acheteMunition      AchatMunition[]
  reservations        Reservation[]
}

model Habilitation {
  id                  Int                   @id @default(autoincrement())
  libelle             String
  possedeHabilitation PossedeHabilitation[]
  armes               Arme[]
}

model Arme {
  id             Int           @id @default(autoincrement())
  numSerie       Int           @unique
  nom            String
  tarif          Decimal       @db.Money
  idHabilitation Int
  idMunition     Int
  habilitation   Habilitation  @relation(fields: [idHabilitation], references: [id])
  munition       Munition      @relation(fields: [idMunition], references: [id])
  Reservation    Reservation[]
}

model AchatMunition {
  id          Int      @id @default(autoincrement())
  quantite    Int
  numLicencie Int
  idMunition  Int
  munition    Munition @relation(fields: [idMunition], references: [id])
  licencie    Licencie @relation(fields: [numLicencie], references: [numLicencie])
}

model PossedeHabilitation {
  id             Int          @id @default(autoincrement())
  dateObtention  DateTime     @db.Date
  numLicencie    Int
  idHabilitation Int
  habilitation   Habilitation @relation(fields: [idHabilitation], references: [id])
  licencie       Licencie     @relation(fields: [numLicencie], references: [numLicencie])
}

model Munition {
  id            Int             @id @default(autoincrement())
  libelle       String
  tailleBoite   Int
  armes         Arme[]
  AchatMunition AchatMunition[]
}

model Reservation {
  num          Int       @id @default(autoincrement())
  date         DateTime  @db.Date
  numLicencie  Int?
  idPersonne   Int?
  numAgrement  Int?
  idArme       Int
  idPas        Int
  licencie     Licencie? @relation(fields: [numLicencie], references: [numLicencie])
  personne     Personne? @relation(fields: [idPersonne], references: [id])
  moniteur     Moniteur? @relation(fields: [numAgrement], references: [numAgrement])
  arme         Arme      @relation(fields: [idArme], references: [id])
  Creneau      Creneau?  @relation(fields: [creneauHeure], references: [heure])
  creneauHeure DateTime? @db.Time(3)
  Pas          Pas?      @relation(fields: [pasId], references: [id])
  pasId        Int?
}

model Creneau {
  heure        DateTime      @id @db.Time(3)
  reservations Reservation[]
}

model Pas {
  id           Int           @id @default(autoincrement())
  num          Int
  idStand      Int
  stand        Stand         @relation(fields: [idStand], references: [id])
  reservations Reservation[]
}

model Stand {
  id       Int   @id @default(autoincrement())
  distance Int
  pas      Pas[]
}
